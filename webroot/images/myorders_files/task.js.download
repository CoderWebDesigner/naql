// display the loading animation
$('.postLoading').show();

// declaring the most used variables
var currentDateObj = new Date();
var currentDate = Date.parse(currentDateObj);
var OwnerId = localStorage.getItem('OwnerId');
var UserId =  localStorage.getItem('UserId');
var UserGroup = localStorage.getItem('UserGroup');
var URL = "http://localhost/naql/";

// map function
var mapClicked = 0;
function myMap() {
    var myCenter = new google.maps.LatLng(localStorage.getItem("start_lat"),localStorage.getItem("start_long"));
    var mapCanvas = document.getElementById(localStorage.getItem("mapContainerID"));
    var mapOptions = {center: myCenter, zoom: 15};
    var map = new google.maps.Map(mapCanvas, mapOptions);
    var marker = new google.maps.Marker({position:myCenter,animation:google.maps.Animation.BOUNCE});
    marker.setMap(map);
    var myCity = new google.maps.Circle({
        center: myCenter,
        radius: 3000,
        strokeColor: "#0000FF",
        strokeOpacity: 0.8,
        strokeWeight: 2,
        fillColor: "#0000FF",
        fillOpacity: 0.4
      });
      myCity.setMap(map);
}

// rating the owner for the user
function ratingOwner(id){
    var stars = $('#'+id).attr("stars");
    var count = $('#'+id).attr("countOdRating");
    var starsToShow = Math.round(stars / count);
    if (starsToShow>0 && starsToShow<=1){
        $('#'+id).html('<img src="'+URL+'images/emptyRating.png" alt="rating" class="userRating2">'
            +'<img src="'+URL+'images/emptyRating.png" alt="rating" class="userRating2">'
            +'<img src="'+URL+'images/emptyRating.png" alt="rating" class="userRating2">'
            +'<img src="'+URL+'images/emptyRating.png" alt="rating" class="userRating2">'
            +'<img src="'+URL+'images/rating.png" alt="rating" class="userRating2">');
    }
    if (starsToShow>1 && starsToShow<=2){
        $('#'+id).html('<img src="'+URL+'images/emptyRating.png" alt="rating" class="userRating2">'
            +'<img src="'+URL+'images/emptyRating.png" alt="rating" class="userRating2">'
            +'<img src="'+URL+'images/emptyRating.png" alt="rating" class="userRating2">'
            +'<img src="'+URL+'images/rating.png" alt="rating" class="userRating2">'
            +'<img src="'+URL+'images/rating.png" alt="rating" class="userRating2">');
    }
    if (starsToShow>2 && starsToShow<=3){
        $('#'+id).html('<img src="'+URL+'images/emptyRating.png" alt="rating" class="userRating2">'
            +'<img src="'+URL+'images/emptyRating.png" alt="rating" class="userRating2">'
            +'<img src="'+URL+'images/rating.png" alt="rating" class="userRating2">'
            +'<img src="'+URL+'images/rating.png" alt="rating" class="userRating2">'
            +'<img src="'+URL+'images/rating.png" alt="rating" class="userRating2">');
    }
    if (starsToShow>3 && starsToShow<=4){
        $('#'+id).html('<img src="'+URL+'images/emptyRating.png" alt="rating" class="userRating2">'
            +'<img src="'+URL+'images/rating.png" alt="rating" class="userRating2">'
            +'<img src="'+URL+'images/rating.png" alt="rating" class="userRating2">'
            +'<img src="'+URL+'images/rating.png" alt="rating" class="userRating2">'
            +'<img src="'+URL+'images/rating.png" alt="rating" class="userRating2">');
    }
    if (starsToShow>4){
        $('#'+id).html('<img src="'+URL+'images/rating.png" alt="rating" class="userRating2">'
            +'<img src="'+URL+'images/rating.png" alt="rating" class="userRating2">'
            +'<img src="'+URL+'images/rating.png" alt="rating" class="userRating2">'
            +'<img src="'+URL+'images/rating.png" alt="rating" class="userRating2">'
            +'<img src="'+URL+'images/rating.png" alt="rating" class="userRating2">');
    }
}

// use these two buttons to switch between current orders and previous orders
$('#currentOrdersBtn').click(function(){
    $('#currentOrders').show();
    $('#prevOrders').hide();
    $('#currentOrdersBtn').css('border-bottom', '03px #ffad33 solid');
    $('#prevOrdersBtn').css('border-bottom', 'none');
    $('#currentOrdersBtn').find('h5').addClass('text-warning');
    $('#prevOrdersBtn').find('h5').removeClass('text-warning');});

$('#prevOrdersBtn').click(function(){
    $('#prevOrders').show();
    $('#currentOrders').hide();
    $('#prevOrdersBtn').css('border-bottom', '03px #ffad33 solid');
    $('#currentOrdersBtn').css('border-bottom', 'none');
    $('#prevOrdersBtn').find('h5').addClass('text-warning');
    $('#currentOrdersBtn').find('h5').removeClass('text-warning');
});


if (UserGroup == 1) {
    // display current orders for "admin"
    $.post("http://localhost/naql/api/reservations/orders/"+OwnerId+".json",
    function(data, status){
        var currentObj = data.data;
        if(currentObj.length == 0){
            $('#currentOrders').html('<div class="col-12 bg-white text-center"><img src="'+URL+'images/404.png" class="img-fluid my-5"><h4 class="text-center text-danger">لا يوجد طلبات حالياً</h4><a href="'+URL+'"><button class="btn btn-outline-secondary py-3 my-5" onclick="window.location="'+URL+'"><h5 class="my-auto mx-5">العودة للصفحة الرئيسية</h5></button></a></div>');}
        createCurrentOrdersForAdmin(currentObj);});
    // display previous orders for "admin"
    $.post("http://localhost/naql/api/reservations/history/1.json",
    {ownerID :OwnerId, status : 'completed'},
    function(data, status){
        var obj = data.data;
        $('.postLoading').hide();
        if(obj.length == 0){
            $('#prevOrders').html('<div class="col-12 bg-white text-center"><img src="'+URL+'images/404.png" class="img-fluid my-5"><h4 class="text-center text-danger">لا يوجد طلبات حالياً</h4><a href="'+URL+'"><button class="btn btn-outline-secondary py-3 my-5" onclick="window.location="'+URL+'"><h5 class="my-auto mx-5">العودة للصفحة الرئيسية</h5></button></a></div>');}
        createPrevOrdersAdmin(obj);});}

else if (UserGroup == 2){
    // displaying current orders for "user"
    $.post("http://localhost/naql/api/reservations/talabaty/"+UserId+".json",
    function(data, status){
        var currentObj = data.data;
        if(currentObj.length == 0){
            $('#currentOrders').html('<div class="col-12 bg-white text-center"><img src="'+URL+'images/404.png" class="img-fluid my-5"><h4 class="text-center text-danger">لا يوجد طلبات حالياً</h4><a href="'+URL+'"><button class="btn btn-outline-secondary py-3 my-5" onclick="window.location="'+URL+'"><h5 class="my-auto mx-5">العودة للصفحة الرئيسية</h5></button></a></div>');}
        createCurrentOrdersForUser(currentObj);});
    // displaying previous orders for "user"
    $.post("http://localhost/naql/api/reservations/history/1.json",
    {userID : UserId, status : 'completed'},
    function(data, status){
        var obj = data.data;
        $('.postLoading').hide();
        if(obj.length == 0){
            $('#prevOrders').html('<div class="col-12 bg-white text-center"><img src="'+URL+'images/404.png" class="img-fluid my-5"><h4 class="text-center text-danger">لا يوجد طلبات حالياً</h4><a href="'+URL+'"><button class="btn btn-outline-secondary py-3 my-5" onclick="window.location="'+URL+'"><h5 class="my-auto mx-5">العودة للصفحة الرئيسية</h5></button></a></div>');}
        createPrevOrdersUser(obj);});}

else {
    // displaying current orders for "owner"
    $.post("http://localhost/naql/api/reservations/orders/"+OwnerId+".json",
    function(data, status){
        var currentObj = data.data;
        if(currentObj.length == 0){
            $('#currentOrders').html('<div class="col-12 bg-white text-center"><img src="'+URL+'images/404.png" class="img-fluid my-5"><h4 class="text-center text-danger">لا يوجد طلبات حالياً</h4><a href="'+URL+'"><button class="btn btn-outline-secondary py-3 my-5" onclick="window.location="'+URL+'"><h5 class="my-auto mx-5">العودة للصفحة الرئيسية</h5></button></a></div>');}
        createCurrentOrdersForOwner(currentObj);});
    // displaying previous orders for "owner"
    $.post("http://localhost/naql/api/reservations/history/1.json",
    {ownerID : OwnerId, status : 'completed'},
    function(data, status){
        var obj = data.data;
        $('.postLoading').hide();
        if(obj.length == 0){
            $('#prevOrders').html('<div class="col-12 bg-white text-center"><img src="'+URL+'images/404.png" class="img-fluid my-5"><h4 class="text-center text-danger">لا يوجد طلبات حالياً</h4><a href="'+URL+'"><button class="btn btn-outline-secondary py-3 my-5" onclick="window.location="'+URL+'"><h5 class="my-auto mx-5">العودة للصفحة الرئيسية</h5></button></a></div>');}
        createPrevOrdersOwner(obj);});}

// current orders for "admin"
function createCurrentOrdersForAdmin(currentObj) {
    for(var i = 0 ; i < currentObj.length ; i++) {
        $('#currentOrders').append('<div class="container w-80" reservationID="'+ currentObj[i].id+'" id="admincontainer'+i+1+'"></div>');
        $('#admincontainer'+i+1).html('<div class="row p-2 bg-white my-5 mx-2 orderContainer" id="adminrow'+i+1+'"></div>');
        $('#adminrow'+i+1).html('<div class="col-2 my-auto" id="admincol'+i+1+'"></div>'
            +'<div class="col-6 col-lg-7 text-right my-auto" id="admincol'+i+2+'"></div>'
            +'<div class="col-4 col-lg-3 my-auto" id="admincol'+i+3+'"></div>'
            +'<div class="col-12 text-right" dir="rtl" id="admincol'+i+4+'"></div>'
            +'<div class="col-12 text-right" dir="rtl" id="admincol'+i+5+'"></div>'
            +'<div class="col-12 text-right" dir="rtl" id="admincol'+i+6+'"></div>'
            +'<div class="col-12 text-right" id="admincol'+i+7+'"></div>'
            +'<div class="col-12 text-right my-3"  dir="rtl" id="admincol'+i+9+'"></div>'
            +'<div class="col-12 text-right text-center" dir="rtl" id="admincol'+i+10+'"></div>');
        $('#admincol'+i+1).html('<img src="'+URL+'images/earth_globe.png" '
            +'id="map'+i+'" start_lat="'+currentObj[i].start_lat+'" start_long="'+currentObj[i].start_long+'" '
            +'mapContainerID="div'+i+'" alt="Location" class="img-fluid w-75 map">'
            +'<button type="button" class="btn btn-secondary showOffers my-2" reservationID="'+currentObj[i].id+'">'
            +'<h6 class="my-auto">العروض</h6></button>'
            +'<div id="div'+i+'" class="mapContainer"><h3>Ahmed</h3></div>');
        $('#admincol'+i+2).html('<h5><b>'+currentObj[i].user.username+'</b></h5>'
            +'<h6>طلب رقم : <span>'+currentObj[i].id+'</span></h6>');
        $('#admincol'+i+3).html('<div class="ownerImgContainer">'
            +'<img src="http://localhost/naql/library/profile/'+currentObj[i].user.photo+'" '
            +'alt="ProfileImage" class="ownerImage"></div>');
        $('#admincol'+i+4).html('<h6 class="py-2 pr-5">تاريخ / وقت : <span dir="ltr">'+currentObj[i].date+'</span></h6>');
        $('#admincol'+i+5).html('<h6 class="py-2 pr-5">نوع التعاقد : '+currentObj[i].reservation_type.name+'</h6>');
        $('#admincol'+i+6).html('<h6 class="py-2 pr-5">طلب تم منذ : '
            +Math.floor((currentDate - Date.parse(currentObj[i].created))/(1000*60*60*24))
            +' يوم و '
            +Math.floor(((currentDate - Date.parse(currentObj[i].created))%(1000*60*60*24))/(1000*60*60))
            +' ساعة </h6>');
        $('#admincol'+i+7).html('<div class="container" id="admininternalContainer'+i+1+'"></div>');
        $('#admininternalContainer'+i+1).html('<div class="row my-auto" dir="rtl" id="admininternalRow'+i+1+'"></div>');
        $('#admininternalRow'+i+1).html('<div class="col-1 text-left my-2">'
            +'<img src="'+URL+'images/solid-green-circle.png" alt="green bullet" class="circleBullet"></div>'
            +'<div class="col-11 my-2">'
            +'<h6>نقطة الانطلاق : <span dir="rtl">'+currentObj[i].start_point+'</span></h6></div>'
            +'<div class="col-1 text-left my-2">'
            +'<img src="'+URL+'images/red-solid-circle.png" alt="red bullet" class="circleBullet"></div>'
            +'<div class="col-11 my-2"><h6>نقطة الوصول : <span dir="rtl">'+currentObj[i].end_point+'</span></h6></div>');
        $('#admincol'+i+9).html('<h6 class="bg-light p-3 mx-4">تفاصيل الطلب : '+currentObj[i].description+'</h6>');
        
        // update the price zone. offer a price or wait customer approval
        var numberOfPrices = currentObj[i].owner_prices.length;
        if(numberOfPrices == 0){
            $('#admincol'+i+10).html('<hr><form class="form-inline pt-5">'
                +'<h6 class="float-right">من فضلك أدخل السعر المناسب : </h6>'
                +'<div class="form-group mx-sm-3 mb-2">'
                +'<input type="number" class="form-control inputPrice" id="newprice'+i+'"></div></form>'
                +'<button type="button" class="my-3 py-3 px-5 mb-3 btn btn-secondary sendRequest" '
                +'id="sendRequest'+i+1+'" '
                +'ownerID="'+ currentObj[i].owner_id +'" '
                +'reservationID="'+ currentObj[i].id +'" '
                +'inputID="newprice'+i+'" '
                +'priceContainer="admincol'+i+10+'">'
                +'<h6 class="my-auto">ارسل عرض الطلب</h6></button>');}
        else {
            for(var ii = 0 ; ii<numberOfPrices ; ii++){
                if(currentObj[i].owner_prices[ii].owner_id == OwnerId){
                    $('#admincol'+i+10).html('<hr><h6 class="text-center py-5">بانتظار موافقة العميل</h6>');
                    break;}
                else {
                    $('#admincol'+i+10).html('<hr><form class="form-inline pt-5">'
                        +'<h6 class="float-right">من فضلك أدخل السعر المناسب : </h6>'
                        +'<div class="form-group mx-sm-3 mb-2">'
                        +'<input type="number" class="form-control inputPrice" id="newprice'+i+'"></div></form>'
                        +'<button type="button" class="my-3 py-3 px-5 mb-3 btn btn-secondary sendRequest" '
                        +'id="sendRequest'+i+1+'" '
                        +'ownerID="'+ currentObj[i].owner_id +'" '
                        +'reservationID="'+ currentObj[i].id +'" '
                        +'inputID="newprice'+i+'" '
                        +'priceContainer="admincol'+i+10+'">'
                        +'<h6 class="my-auto">ارسل عرض الطلب</h6></button>');}
            }
        }
    }

    // add the price offer to the order
    $('.sendRequest').click(function(){
        var clickedButtonID = $(this).attr("id");
        var inputField = $(this).attr("inputID");
        var priceContainer = $(this).attr("priceContainer");
        $.post("http://localhost/naql/api/ownerPrices/add.json",
        {owner_id: OwnerId, reservation_id: $('#'+clickedButtonID).attr("reservationID"),price: $('#'+inputField).val()},
        function(status){
            $('#'+priceContainer).html('<hr><h6 class="text-center py-5">بانتظار موافقة العميل</h6>');})
        }
    );

    // go to the offers of this order
    $('.showOffers').click(function(){
        localStorage.setItem("userGroupID",UserGroup);
        localStorage.setItem("offerID",$(this).attr("reservationID"));
        window.location = ''+URL+'owners/offers';
    });

    // show or hide the start location on the map
    $('.map').click(function(){
        var mapContainerID = $(this).attr("mapContainerID");
        if($(this).hasClass("clicked")==false){
            $('#'+mapContainerID).show();$(this).addClass("clicked");
            localStorage.setItem("start_lat",$(this).attr("start_lat"));
            localStorage.setItem("start_long",$(this).attr("start_long"));
            localStorage.setItem("mapContainerID",$(this).attr("mapContainerID"));
            $('#'+mapContainerID).html('<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDI7pISFjXEJgcNN9OAJQU4ceVqOBxtYuw&callback=myMap"></script>');}
        else {
            $('#'+mapContainerID).hide();$(this).removeClass("clicked");}
        }
    );
}

// current orders for "owner"
function createCurrentOrdersForOwner(currentObj) {
    for(var i = 0 ; i < currentObj.length ; i++){
        $('#currentOrders').append('<div class="container w-80" id="owner_container'+i+1+'"></div>');
        $('#owner_container'+i+1).html('<div class="row p-2 bg-white my-5 mx-2 orderContainer" id="owner_row'+i+1+'"></div>');
        $('#owner_row'+i+1).html('<div class="col-2 my-auto" id="owner_col'+i+1+'"></div>'
            +'<div class="col-6 col-lg-7 text-right my-auto" id="owner_col'+i+2+'"></div>'
            +'<div class="col-4 col-lg-3 my-auto" id="owner_col'+i+3+'"></div>'
            +'<div class="col-12 text-right" dir="rtl" id="owner_col'+i+4+'"></div>'
            +'<div class="col-12 text-right" dir="rtl" id="owner_col'+i+5+'"></div>'
            +'<div class="col-12 text-right" dir="rtl" id="owner_col'+i+6+'"></div>'
            +'<div class="col-12 text-right" dir="rtl" id="owner_col'+i+7+'"></div>'
            +'<div class="col-12 text-right" dir="rtl" id="owner_col'+i+8+'"></div>'
            +'<div class="col-12 text-right my-3"  dir="rtl" id="owner_col'+i+9+'"></div>'
            +'<div class="col-12 text-right text-center" dir="rtl" id="owner_col'+i+10+'"></div>');
        $('#owner_col'+i+1).html('<img src="'+URL+'images/earth_globe.png" id="map'+i+'" '
            +'start_lat="'+currentObj[i].start_lat+'" start_long="'+currentObj[i].start_long+'" '
            +'mapContainerID="div'+i+'" alt="Location" class="img-fluid w-75 map">'
            +'<div id="div'+i+'" class="mapContainer"><h3>Ahmed</h3></div>');
        $('#owner_col'+i+2).html('<h5><b>'+currentObj[i].user.username+'</b></h5>'
            +'<h6>طلب رقم : <span>'+currentObj[i].id+'</span></h6>'
            +'<h6>نوع المعدة : <span>'+currentObj[i].machine_detail.name+'</span></h6>');
        $('#owner_col'+i+3).html('<div class="ownerImgContainer">'
            +'<img src="http://localhost/naql/library/profile/'+currentObj[i].user.photo+'" '
            +'alt="ProfileImage" class="ownerImage"></div>');
        $('#owner_col'+i+4).html('<h6 class="py-2 pr-5">تاريخ / وقت : <span dir="ltr">'+currentObj[i].date+'</span></h6>');
        $('#owner_col'+i+5).html('<h6 class="py-2 pr-5">نوع التعاقد : '+currentObj[i].reservation_type.name_en+'</h6>');
        $('#owner_col'+i+6).html('<h6 class="py-2 pr-5">طلب تم منذ : '
            +Math.floor((currentDate - Date.parse(currentObj[i].created))/(1000*60*60*24))
            +' يوم و '
            +Math.floor(((currentDate - Date.parse(currentObj[i].created))%(1000*60*60*24))/(1000*60*60))
            +' ساعة </h6>');
        $('#owner_col'+i+7).html('<div class="container" id="owner_internalContainer'+i+1+'"></div>');
        $('#owner_internalContainer'+i+1).html('<div class="row my-auto" dir="rtl" id="owner_internalRow'+i+1+'"></div>');
        $('#owner_internalRow'+i+1).html('<div class="col-1 text-left my-2">'
            +'<img src="'+URL+'images/solid-green-circle.png" alt="green bullet" class="circleBullet"></div>'
            +'<div class="col-11 my-2">'
            +'<h6>نقطة الانطلاق : <span dir="rtl">'+currentObj[i].start_point+'</span></h6></div>'
            +'<div class="col-1 text-left my-2"><img src="'+URL+'images/red-solid-circle.png" alt="red bullet" '
            +'class="circleBullet"></div>'
            +'<div class="col-11 my-2"><h6>نقطة الوصول : <span dir="rtl">'+currentObj[i].end_point+'</span></h6></div>');
        $('#owner_col'+i+9).html('<h6 class="bg-light p-3 mx-4">تفاصيل الطلب : '+currentObj[i].description+'</h6>');

        // update the price zone. offer a price or wait customer approval
        var numberOfPrices = currentObj[i].owner_prices.length;
        if(numberOfPrices == 0){
            $('#owner_col'+i+10).html('<hr><form class="form-inline pt-5">'
                +'<h6 class="float-right">من فضلك أدخل السعر المناسب : </h6>'
                +'<div class="form-group mx-sm-3 mb-2">'
                +'<input type="number" class="form-control inputPrice" id="newprice'+i+'"></div></form>'
                +'<button type="button" class="my-3 py-3 px-5 mb-3 btn btn-secondary sendRequest" '
                +'id="sendRequest'+i+1+'" '
                +'ownerID="'+ currentObj[i].owner_id +'" '
                +'reservationID="'+ currentObj[i].id +'" '
                +'inputID="newprice'+i+'" '
                +'priceContainer="owner_col'+i+10+'">'
                +'<h6 class="my-auto">ارسل عرض الطلب</h6></button>');}
        else {
            for(var ii = 0 ; ii<numberOfPrices ; ii++){
                if(currentObj[i].owner_prices[ii].owner_id == OwnerId){
                    $('#owner_col'+i+10).html('<hr><h6 class="text-center py-5">بانتظار موافقة العميل</h6>');
                    break;}
                else {
                    $('#owner_col'+i+10).html('<hr><form class="form-inline pt-5">'
                        +'<h6 class="float-right">من فضلك أدخل السعر المناسب : </h6>'
                        +'<div class="form-group mx-sm-3 mb-2">'
                        +'<input type="number" class="form-control inputPrice" id="newprice'+i+'"></div></form>'
                        +'<button type="button" class="my-3 py-3 px-5 mb-3 btn btn-secondary sendRequest" '
                        +'id="sendRequest'+i+1+'" '
                        +'ownerID="'+ currentObj[i].owner_id +'" '
                        +'reservationID="'+ currentObj[i].id +'" '
                        +'inputID="newprice'+i+'" '
                        +'priceContainer="owner_col'+i+10+'">'
                        +'<h6 class="my-auto">ارسل عرض الطلب</h6></button>');}
            }
        }
    }

    // add the price offer to the order
    $('.sendRequest').click(function(){
        var clickedButtonID = $(this).attr("id");
        var inputField = $(this).attr("inputID");
        var priceContainer = $(this).attr("priceContainer");
        $.post("http://localhost/naql/api/ownerPrices/add.json",
        {owner_id: OwnerId, reservation_id: $('#'+clickedButtonID).attr("reservationID"), price: $('#'+inputField).val()},
        function(status){
            $('#'+priceContainer).html('<hr><h6 class="text-center py-5">بانتظار موافقة العميل</h6>');})
        }
    );

    // show or hide the start location on the map
    $('.map').click(function(){
        var mapContainerID = $(this).attr("mapContainerID");
        if($(this).hasClass("clicked")==false){
            $('#'+mapContainerID).show();$(this).addClass("clicked");
            localStorage.setItem("start_lat",$(this).attr("start_lat"));
            localStorage.setItem("start_long",$(this).attr("start_long"));
            localStorage.setItem("mapContainerID",$(this).attr("mapContainerID"));
            $('#'+mapContainerID).html('<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDI7pISFjXEJgcNN9OAJQU4ceVqOBxtYuw&callback=myMap"></script>');}
        else {
            $('#'+mapContainerID).hide();$(this).removeClass("clicked");}
        }
    );
}

// current orders for "user"
function createCurrentOrdersForUser(currentObj) {
    for(var i = 0 ; i < currentObj.length ; i++) {
        $('#currentOrders').append('<div class="container w-80" '
            +'id="user_container'+i+1+'"></div>');
        $('#user_container'+i+1).html('<div class="row p-2 bg-white my-5 mx-2 orderContainer user_container" '
            +'id="user_row'+i+1+'" reservationID="'+ currentObj[i].id+'" ></div>');
        $('#user_row'+i+1).html('<div class="col-2 my-auto" id="user_col'+i+1+'"></div>'
            +'<div class="col-6 col-lg-7 text-right my-auto" id="user_col'+i+2+'"></div>'
            +'<div class="col-4 col-lg-3 my-auto" id="user_col'+i+3+'"></div>'
            +'<div class="col-12 text-right" dir="rtl" id="user_col'+i+4+'"></div>'
            +'<div class="col-12 text-right" dir="rtl" id="user_col'+i+5+'"></div>'
            +'<div class="col-12 text-right" dir="rtl" id="user_col'+i+6+'"></div>'
            +'<div class="col-12 text-right" dir="rtl" id="user_col'+i+7+'"></div>'
            +'<div class="col-12 text-right" dir="rtl" id="user_col'+i+8+'"></div>'
            +'<div class="col-12 text-right"  dir="rtl" id="user_col'+i+9+'"></div>');
        $('#user_col'+i+1).html('<img src="'+URL+'images/earth_globe.png" id="map'+i+'" '
            +'start_lat="'+currentObj[i].start_lat+'" start_long="'+currentObj[i].start_long+'" mapContainerID="div'+i+'" '
            +'alt="Location" class="img-fluid w-75 map"><div id="div'+i+'" class="mapContainer"><h3>Ahmed</h3></div>');
        $('#user_col'+i+2).html('<h5><b>'+currentObj[i].machine_detail.name+'</b></h5>'
            +'<h6>طلب رقم : <span>'+currentObj[i].id+'</span></h6>');
        $('#user_col'+i+3).html('<div class="ownerImgContainer">'
            +'<img src="http://localhost/naql/library/machine/'+currentObj[i].machine_detail.machine_photo+'" '
            +'alt="ProfileImage" class="ownerImage"></div>');
        $('#user_col'+i+4).html('<h6 class="py-2 pr-5">تاريخ / وقت : <span dir="ltr">'+currentObj[i].date+'</span></h6>');
        $('#user_col'+i+5).html('<h6 class="py-2 pr-5">نوع التعاقد : '+currentObj[i].reservation_type.name_en+'</h6>');
        $('#user_col'+i+6).html('<h6 class="py-2 pr-5">طلب تم منذ : '
            +Math.floor((currentDate - Date.parse(currentObj[i].created))/(1000*60*60*24))
            +' يوم و '
            +Math.floor(((currentDate - Date.parse(currentObj[i].created))%(1000*60*60*24))/(1000*60*60))
            +' ساعة </h6>');
        $('#user_col'+i+7).html('<div class="container" id="user_internalContainer'+i+1+'"></div>');
        $('#user_internalContainer'+i+1).html('<div class="row my-auto" dir="rtl" id="user_internalRow'+i+1+'"></div>');
        $('#user_internalRow'+i+1).html('<div class="col-1 text-left my-2">'
            +'<img src="'+URL+'images/solid-green-circle.png" alt="green bullet" class="circleBullet"></div>'
            +'<div class="col-11 my-2">'
            +'<h6>نقطة الانطلاق : <span dir="rtl">'+currentObj[i].start_point+'</span></h6></div>'
            +'<div class="col-1 text-left my-2">'
            +'<img src="'+URL+'images/red-solid-circle.png" alt="red bullet" class="circleBullet"></div>'
            +'<div class="col-11 my-2"><h6>نقطة الوصول : <span dir="rtl">'+currentObj[i].end_point+'</span></h6></div>');
        $('#user_col'+i+9).html('<h6 class="bg-light p-3 mx-4">تفاصيل الطلب : '+currentObj[i].description+'</h6>');}
    
    // show or hide the start location on the map    
    $('.map').click(function(){
        mapClicked = 1;
        var mapContainerID = $(this).attr("mapContainerID");
        if($(this).hasClass("clicked")==false){
            $('#'+mapContainerID).show();$(this).addClass("clicked");
            localStorage.setItem("start_lat",$(this).attr("start_lat"));
            localStorage.setItem("start_long",$(this).attr("start_long"));
            localStorage.setItem("mapContainerID",$(this).attr("mapContainerID"));
            $('#'+mapContainerID).html('<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDI7pISFjXEJgcNN9OAJQU4ceVqOBxtYuw&callback=myMap"></script>');}
        else {
            $('#'+mapContainerID).hide();$(this).removeClass("clicked");}
        }
    );

    // as a user, click on the order body to go to the offers of this order
    $('.user_container').click(function(){
        if(mapClicked==1){
            mapClicked = 0;}
        else {
            localStorage.setItem("userGroupID",2);
            localStorage.setItem("offerID",$(this).attr("reservationID"));
            window.location = ''+URL+'owners/offers';
        }
    });
}

// previous orders for "admin"
function createPrevOrdersAdmin (obj){
    for(var i = 0 ; i<obj.length ; i++){
        console.log(obj[i].owner_id);
        $('#prevOrders').append('<div class="container w-80" id="container'+i+1+'"></div>');
        $('#container'+i+1).html('<div class="row p-2 bg-white my-5 mx-2 orderContainer" id="row'+i+1+'"></div>');
        $('#row'+i+1).html('<div class="col-4 my-auto" id="col'+i+2+'"></div>'
            +'<div class="col-10 col-md-5 text-right my-auto" dir="rtl" id="col'+i+3+'"></div>'
            +'<div class="col-2 col-md-3 text-center my-auto" id="col'+i+4+'"></div>'
            +'<div class="col-12 my-2" id="col'+i+5+'"></div>'
            +'<div class="col-12 col-lg-6 text-right"  dir="rtl" id="col'+i+6+'"></div>'
            +'<div class="col-12 col-lg-6 text-right"  dir="rtl" id="col'+i+7+'"></div>'
            +'<div class="col-12 text-right m-3"  dir="rtl" id="col'+i+8+'"></div>'
            +'<div class="col-12 OrderEnd" id="col'+i+9+'"></div>');
        // $('#col'+i+2).html('<img src="'+URL+'images/inf.png" alt="" ownerID="'+obj[i].owner_id+'" class="img-fluid infoIcon driver_info">');
        $('#col'+i+3).html('<h5><b>'+obj[i].user.username+'</b></h5>');
        $('#col'+i+4).html('<div class="ownerImgContainer">'
            +'<img src="http://localhost/naql/library/profile/'+obj[i].user.photo+'" '
            +'alt="ProfileImage" class="ownerImage"></div>');
        $('#col'+i+5).html('<div class="container" id="internalContainerPrev'+i+1+'"></div>');
        $('#internalContainerPrev'+i+1).html('<div class="row my-auto" dir="rtl" id="internalRowPrev'+i+1+'"></div>');
        $('#internalRowPrev'+i+1).html('<div class="col-1 my-2">'
            +'<img src="'+URL+'images/solid-green-circle.png" alt="green bullet" class="circleBullet"></div>'
            +'<div class="col-11 text-right my-2">'
            +'<h6>نقطة الانطلاق : <span dir="rtl">'+obj[i].start_point+'</span></h6></div>'
            +'<div class="col-1 my-2"><img src="'+URL+'images/red-solid-circle.png" alt="red bullet" class="circleBullet"></div>'
            +'<div class="col-11 text-right my-2"><h6>نقطة الوصول : <span dir="rtl">'+obj[i].end_point+'</span></h6></div>');
        $('#col'+i+6).html('<h6 class="py-2 pr-5">نوع التعاقد : '+obj[i].reservation_type.name_en+'</h6>');
        $('#col'+i+7).html('<h6 class="py-2 pr-5">تاريخ / وقت : <span dir="ltr">'+obj[i].date+'</span></h6>');
        $('#col'+i+8).html('<h6 class="bg-light p-3 mx-4">تفاصيل الطلب : '+obj[i].description+'</h6>');
        $('#col'+i+9).append('<div class="container" id="internalContainer'+i+1+'"></div>');
        $('#internalContainer'+i+1).html('<div class="row" id="internalRow'+i+1+'"></div>');
        $('#internalRow'+i+1).html('<div class="col-3 text-center my-auto" id="internalCol'+i+1+'"></div>'
            +'<div class="col-7 text-right my-auto" id="internalCol'+i+2+'"></div>'
            +'<div class="col-2 text-left my-auto" id="internalCol'+i+3+'"></div>');
        // $('#internalCol'+i+1).html('<img src="'+URL+'images/okSign.png" class="img-fluid d-block mx-auto okSign" '
        //     +'id="okSign-'+i+1+'" '
        //     +'orderID="'+obj[i].id+'" '
        //     +'ownerName="'+obj[i].owner.user.username+'" '
        //     +'orderDate=" '+obj[i].date+'" '
        //     +'ownerID="'+obj[i].owner.id+'" '
        //     +'ownerPhoto="'+obj[i].owner.user.photo+'" '
        //     +'startPoint="'+obj[i].start_point+'" '
        //     +'endPoint="'+obj[i].end_point+'" '
        //     +'userID="'+obj[i].user_id+'" '
        //     +'alt="like">');
        $('#internalCol'+i+2).html('<h6>سعر التوصيل : <span>'+obj[i].price+'</span></h6>');
        $('#internalCol'+i+3).html('<img src="'+URL+'img/dollar.png" alt="price" class="img-fluid dollarSign">');
    }

    // // rate this owner
    // $('.okSign').click(function(){
    //     localStorage.setItem("orderID",$(this).attr("orderID"));
    //     localStorage.setItem("ownerName",$(this).attr("ownerName"));
    //     localStorage.setItem("orderDate",$(this).attr("orderDate"));
    //     localStorage.setItem("ownerID",$(this).attr("ownerID"));
    //     localStorage.setItem("ownerPhoto",$(this).attr("ownerPhoto"));
    //     localStorage.setItem("orderStartPoint",$(this).attr("startPoint"));
    //     localStorage.setItem("orderEndPoint",$(this).attr("endPoint"));
    //     localStorage.setItem("userID",$(this).attr("userID"));
    //     window.location = ""+URL+"owners/rating";
    // });

    // go to the driver info
    // $('.driver_info').click(function(){
    //     localStorage.setItem("OwnerId", $(this).attr("ownerID"));
    //     window.location = ""+URL+"owners/driverdetails";
    // });
}

//previous orders for "owner"
function createPrevOrdersOwner(obj) {
    for(var i = 0 ; i < obj.length ; i++){
        $('#prevOrders').append('<div class="container w-80" id="container'+i+1+'"></div>');
        $('#container'+i+1).html('<div class="row p-2 bg-white my-5 mx-2 orderContainer" id="row'+i+1+'"></div>');
        $('#row'+i+1).html('<div class="col-4 my-auto" id="col'+i+2+'"></div>'
            +'<div class="col-6 col-md-5 text-right my-auto" dir="rtl" id="col'+i+3+'"></div>'
            +'<div class="col-2 col-md-3 text-center my-auto" id="col'+i+4+'"></div>'
            +'<div class="col-12 my-2" id="col'+i+5+'"></div>'
            +'<div class="col-12 col-lg-6 text-right"  dir="rtl" id="col'+i+6+'"></div>'
            +'<div class="col-12 col-lg-6 text-right"  dir="rtl" id="col'+i+7+'"></div>'
            +'<div class="col-12 text-right m-3"  dir="rtl" id="col'+i+8+'"></div>'
            +'<div class="col-12 OrderEnd" id="col'+i+9+'"></div>');
        $('#col'+i+2).html('<img src="'+URL+'images/chat.png" alt="Chat" class="img-fluid chatIcon">');
        $('#col'+i+3).html('<h5><b>'+ obj[i].user.username +'</b></h5>');
        $('#col'+i+4).html('<div class="ownerImgContainer">'
            +'<img src="http://localhost/naql/library/profile/'+obj[i].user.photo+'" '
            +'alt="ProfileImage" class="ownerImage"></div>');
        $('#col'+i+5).html('<div class="container" id="internalContainerPrev'+i+1+'"></div>');
        $('#internalContainerPrev'+i+1).html('<div class="row my-auto" dir="rtl" id="internalRowPrev'+i+1+'"></div>');
        $('#internalRowPrev'+i+1).html('<div class="col-1 my-2">'
            +'<img src="'+URL+'images/solid-green-circle.png" alt="green bullet" class="circleBullet"></div>'
            +'<div class="col-11 text-right my-2">'
            +'<h6>نقطة الانطلاق : <span dir="rtl">'+obj[i].start_point+'</span></h6></div>'
            +'<div class="col-1 my-2"><img src="'+URL+'images/red-solid-circle.png" alt="red bullet" class="circleBullet"></div>'
            +'<div class="col-11 text-right my-2"><h6>نقطة الوصول : <span dir="rtl">'+obj[i].end_point+'</span></h6></div>');
        $('#col'+i+6).html('<h6 class="py-2 pr-5">نوع التعاقد : '+obj[i].reservation_type.name_en+'</h6>');
        $('#col'+i+7).html('<h6 class="py-2 pr-5">تاريخ / وقت : <span dir="ltr">'+obj[i].date+'</span></h6>');
        $('#col'+i+8).html('<h6 class="bg-light p-3 mx-4">تفاصيل الطلب : '+obj[i].description+'</h6><hr>');
        $('#col'+i+9).append('<div class="container" id="internalContainer'+i+1+'"></div>');
        $('#internalContainer'+i+1).html('<div class="row" id="internalRow'+i+1+'"></div>');
        $('#internalRow'+i+1).html('<div class="col-3 text-center my-auto" id="internalCol'+i+1+'"></div>'
            +'<div class="col-7 text-right my-auto" id="internalCol'+i+2+'"></div>'
            +'<div class="col-2 text-left my-auto" id="internalCol'+i+3+'"></div>');
        $('#internalCol'+i+2).html('<h6>سعر التوصيل : <span>'+obj[i].price+'</span></h6>');
        $('#internalCol'+i+3).html('<img src="'+URL+'images/dollar.png" alt="price" class="img-fluid dollarSign">');
    }
}

// previous orders for "user"
function createPrevOrdersUser (obj){
    for(var i = 0 ; i < obj.length ; i++){
        $('#prevOrders').append('<div class="container w-80" id="container'+i+1+'"></div>');
        $('#container'+i+1).html('<div class="row p-2 bg-white my-5 mx-2 orderContainer" id="row'+i+1+'"></div>');
        $('#row'+i+1).html('<div class="col-3 my-auto" id="col'+i+2+'"></div>'
            +'<div class="col-7 text-right my-auto" id="col'+i+3+'"></div>'
            +'<div class="col-2 text-center my-auto" id="col'+i+4+'"></div>'
            +'<div class="col-12 my-2" id="col'+i+5+'"></div>'
            +'<div class="col-12 col-lg-6 text-right"  dir="rtl" id="col'+i+6+'"></div>'
            +'<div class="col-12 col-lg-6 text-right"  dir="rtl" id="col'+i+7+'"></div>'
            +'<div class="col-12 text-right m-3"  dir="rtl" id="col'+i+8+'"></div>'
            +'<div class="col-12 border border-secondary border-bottom-0 border-right-0 border-left-0 OrderEnd" '
            +'id="col'+i+9+'"></div>');
        $('#col'+i+2).html('<img src="'+URL+'images/inf.png" alt="" ownerID="'+obj[i].owner_id+'" machine_detail_id="'+obj[i].machine_detail_id+'" class="img-fluid infoIcon driver_info">');
        $('#col'+i+3).html('<h5><b>'+ obj[i].owner.user.username +'</b></h5>'
            +'<div class="container"><div class="row">'
            +'<div class="col-12 p-0 m-0 text-right" id="userRatingArea'+i+'" stars="'+obj[i].owner.rates[0].stars+'" '
            +'countOdRating="'+obj[i].owner.rates[0].count+'">'
            +'<img src="'+URL+'images/emptyRating.png" alt="rating" class="userRating2">'
            +'<img src="'+URL+'images/emptyRating.png" alt="rating" class="userRating2">'
            +'<img src="'+URL+'images/emptyRating.png" alt="rating" class="userRating2">'
            +'<img src="'+URL+'images/emptyRating.png" alt="rating" class="userRating2">'
            +'<img src="'+URL+'images/emptyRating.png" alt="rating" class="userRating2">'
            +'</div>'
            +'<div class="col-12 my-auto">'
            +'<p>(من <span>'+obj[i].owner.rates[0].count+'</span> عميل)</p>'
            +'</div></div></div>'
            +'<h6 class="py-0">رقم الطلب : '+ obj[i].id +'</h6>');
        $('#col'+i+4).html('<div class="ownerImgContainer">'
            +'<img src="http://localhost/naql/library/profile/'+obj[i].owner.user.photo+'" '
            +'alt="ProfileImage" class="ownerImage"></div>');
        $('#col'+i+5).html('<div class="container" id="internalContainerPrev'+i+1+'"></div>');
        $('#internalContainerPrev'+i+1).html('<div class="row my-auto" dir="rtl" id="internalRowPrev'+i+1+'"></div>');
        $('#internalRowPrev'+i+1).html('<div class="col-1 my-2">'
            +'<img src="'+URL+'images/solid-green-circle.png" alt="green bullet" class="circleBullet"></div>'
            +'<div class="col-11 text-right my-2">'
            +'<h6>نقطة الانطلاق : <span dir="rtl">'+obj[i].start_point+'</span></h6></div>'
            +'<div class="col-1 my-2"><img src="'+URL+'images/red-solid-circle.png" alt="red bullet" class="circleBullet"></div>'
            +'<div class="col-11 text-right my-2"><h6>نقطة الوصول : <span dir="rtl">'+obj[i].end_point+'</span></h6></div>');
        $('#col'+i+6).html('<h6 class="py-2 pr-5">نوع التعاقد : '+obj[i].reservation_type.name_en+'</h6>');
        $('#col'+i+7).html('<h6 class="py-2 pr-5">تاريخ / وقت : <span dir="ltr">'+obj[i].date+'</span></h6>');
        $('#col'+i+8).html('<h6 class="bg-light p-3 mx-4">تفاصيل الطلب : '+obj[i].description+'</h6>');
        $('#col'+i+9).append('<div class="container mt-4" id="internalContainer'+i+1+'"></div>');
        $('#internalContainer'+i+1).html('<div class="row" id="internalRow'+i+1+'"></div>');
        $('#internalRow'+i+1).html('<div class="col-2 text-right my-auto" id="internalCol'+i+1+'"></div>'
            +'<div class="col-3 text-left my-auto" id="internalCol'+i+2+'"></div>'
            +'<div class="col-5 text-right my-auto" id="internalCol'+i+3+'"></div>'
            +'<div class="col-2 text-left my-auto" id="internalCol'+i+4+'"></div>');
        $('#internalCol'+i+1).html('<img src="'+URL+'images/okSign.png" class="img-fluid ratingIcon okSign" '
            +'id="okSign-'+i+1+'" orderID="'+obj[i].id+'" ownerName="'+obj[i].owner.user.username+'" '
            +'orderDate=" '+obj[i].date+'" ownerID="'+obj[i].owner.id+'" ownerPhoto="'+obj[i].owner.user.photo+'" '
            +'startPoint="'+obj[i].start_point+'" endPoint="'+obj[i].end_point+'" userID="'+obj[i].user_id+'" alt="like">');
        $('#internalCol'+i+2).html('<h6>تقييم مقدم الخدمة</h6>');
        $('#internalCol'+i+3).html('<h6>سعر التوصيل : <span>'+obj[i].price+'</span></h6>');
        $('#internalCol'+i+4).html('<img src="'+URL+'images/dollar.png" alt="price" class="img-fluid dollarSign">');
        ratingOwner('userRatingArea'+i);
    }

    // rate this owner
    $('.okSign').click(function(){
        localStorage.setItem("userID",$(this).attr("userID"));
        localStorage.setItem("OwnerId",$(this).attr("ownerID"));
        localStorage.setItem("ownerName",$(this).attr("ownerName"));
        localStorage.setItem("orderID",$(this).attr("orderID"));
        localStorage.setItem("orderDate",$(this).attr("orderDate"));
        localStorage.setItem("ownerPhoto",$(this).attr("ownerPhoto"));
        localStorage.setItem("orderStartPoint",$(this).attr("startPoint"));
        localStorage.setItem("orderEndPoint",$(this).attr("endPoint"));
        window.location = ""+URL+"owners/rating";
    });

    // go to the driver info
    $('.driver_info').click(function(){
        OwnerId = $(this).attr("ownerID");
        localStorage.setItem("OwnerId", $(this).attr("ownerID"));
        console.log(localStorage.getItem("OwnerId"));
        localStorage.setItem("machine_detail_id", $(this).attr("machine_detail_id"));
        console.log(localStorage.getItem("machine_detail_id"));
        window.location = ""+URL+"owners/driverdetails";
    });
}